---
title: 「Video Launch でのビデオ分析のAdobe」
description: 説明
solution: Customer Journey Analytics,Analytics
product: Customer Journey Analytics,Analytics
applies-to: "Customer Journey Analytics,Analytics"
keywords: 「KCS Launch ビデオ分析ハートビート」
resolution: Resolution
internal-notes: "This implementation discussed in this article does not use Adobe Launch extension for Media Analytics."
bug: false
article-created-by: Krunal Oza
article-created-date: "9/16/2022 9:07:03 AM"
article-published-by: Krunal Oza
article-published-date: "9/16/2022 9:25:26 AM"
version-number: 3
article-number: KA-15023
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee0b6fe9-9e35-ed11-9db1-002248086a9c"
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1055'
ht-degree: 0%

---

# Video Launch でのビデオ分析のAdobe

## 説明

<br>環境<br><br>


この記事では、Media Heartbeat SDK を使用して Media Launch にYouTubeビデオトラッキングを実装する手順を説明します。


<br><br>問題/症状<br><br>
<b>前提条件</b>


| <ol>   <li>アクティブなAdobeLaunch 実装がある。</li>   <li>レポートスイートがメディアコレクションで有効になっている。</li>   <li>レポートスイートが、Adobe Experience Cloudの正しい Analytics ログイン会社にマッピングされています。</li>   <li>Launch で公開権限を持っています。Adobe:</li>   <li>Launch UI とその仕組みについて詳しいAdobeです。</li>  </ol><br> |
| --- |



## 解像度


<b>手順 1:新規ルールの作成</b>

「ルール」タブの下の「ルールを追加」ボタンをクリックして、AdobeLaunch プロパティで新しいルールを作成します。 このルールには、YouTubeビデオおよび Video Analytics とYouTube iFrame API スクリプトを読み込むためのイベント条件が含まれます。

- 「名前」テキストボックスにルール名を指定します。




<b>手順 2:イベントや条件の追加</b>

「イベントと条件」の下の「 + 」ボタンをクリックして、YouTubeビデオを起動する条件を作成します。 この例では、YouTubeビデオを起動する特定の div「player」を探すための条件「Element Exists」を追加しました。



<b>手順 3:アクションの追加 — 設定変数</b>

アクションの下の「 + 」ボタンをクリックして、新しいアクション項目を作成します。 これは、ビデオ分析変数を設定するための単一の設定ポイントとして機能します。 ハードコードされた値をいくつか使用しました。 ただし、データ要素を使用してこれらの変数を設定することはできます。

1. 「拡張機能」ドロップダウンから「コア」を選択します。
2. 「アクションタイプ」ドロップダウンから「カスタムコード」を選択します。
3. 「名前」テキストボックスにアクション名を追加します。
4. 「言語」の下の「JavaScript」を選択します。
5. 「グローバルに実行」をオンにします。
6. 「エディタを開く」をクリックします。
7. コードを追加し、「保存」をクリックします。 会社やレポートスイートに従って値を必ず更新してください。



```
(function() {    'use strict';
    // Export symbols.
    window.Configuration = {
        PLAYER: {
            NAME: 'sample player name'
            //VIDEO_ID: 'sample video id',
           //VIDEO_NAME: sample video name'
        },
        VISITOR: {
            MARKETING_CLOUD_ORG_ID: 'experience cloud ID',
            TRACKING_SERVER: 'tracking server',
            DPID: '',
            DPUUID: ''
        },
        APP_MEASUREMENT: {
            RSID: 'report suite id',
            TRACKING_SERVER: 'tracking server',
            PAGE_NAME: 'page name',
            CHAR_SET: 'UTF-8'
        },
        HEARTBEAT: {
            TRACKING_SERVER: 'heartbeat tracking server',
            PUBLISHER: 'publisher id',
            CHANNEL: 'channel',
            OVP: 'ovp name',
            SDK: 'sgk version',
       SSL: 'false',
       DEBUG: 'true'
        }
    };
})();
```


(function() { &#39;use strict&#39;;    //シンボルを書き出します。
    window.Configuration = { PLAYER:{ 名前：&#39;サンプルプレーヤー名&#39; //VIDEO_ID:&#39;サンプルビデオ ID&#39;, //VIDEO_NAME:サンプルのビデオ名&#39; }，訪問者：{ MARKETING_CLOUD_ORG_ID:&#39;experience cloud ID&#39;, TRACKING_SERVER:&#39;トラッキングサーバー&#39;、DPID :&quot;, DPUUID:&quot; }, APP_MEASUREMENT:{ RSID:&#39;レポートスイート ID&#39;、TRACKING_SERVER:&#39;トラッキングサーバー&#39;、PAGE_NAME:&#39;ページ名&#39;、CHAR_SET:&#39;UTF-8&#39; }, HEARTBEAT:{ TRACKING_SERVER:&#39;ハートビートトラッキングサーバー&#39;、パブリッシャー：&#39;publisher id&#39;、チャネル：&#39;channel&#39;、OVP:&#39;ovp name&#39;, SDK:&#39;sgk version&#39;, SSL:&#39;false&#39;, DEBUG:&#39;true&#39; };})();



<b>手順 4:訪問者 ID サービスのアクションの追加</b>

Media Analytics には、訪問者 ID サービスのインスタンスが必要です。 訪問者 ID サービスコードは、Adobe Analytics UI のコードマネージャーからダウンロードする必要があります。

訪問者 ID サービスコードをダウンロードしたら、「アクション」の下の「 + 」ボタンをクリックして新しいアクション項目を作成し、次に、

1. 「拡張機能」ドロップダウンから「コア」を選択します。
2. 「アクションタイプ」ドロップダウンから「カスタムコード」を選択します。
3. 「名前」テキストボックスにアクション名を追加します。
4. 「言語」の下の「JavaScript」を選択します。
5. 「グローバルに実行」をオンにします。
6. 「エディタを開く」をクリックします。
7. 下部に次のコードを追加し、「保存」をクリックします。
8. 下部に次のコードを追加し、「保存」をクリックします。


var visitor = Visitor.getInstance(&quot;Experience CloudID&quot;, { trackingServer:&quot;tracking server&quot;, // s.trackingServer trackingServerSecure と同じ：&quot; tracking server &quot; // s.trackingServerSecure } と同じ );

<b>手順 5:アクションの追加 — Appmeasurement コード</b>

Media Analytics には Appmeasurement のインスタンスが必要です。 Adobe Analytics UI のコードマネージャーからダウンロードする必要があります。

Appmeasurement コードをダウンロードしたら、「アクション」の下の「 + 」ボタンをクリックして新しいアクション項目を作成し、次に、

1. 「拡張機能」ドロップダウンから「コア」を選択します。
2. 「アクションタイプ」ドロップダウンから「カスタムコード」を選択します。
3. 「名前」テキストボックスにアクション名を追加します。
4. 「言語」の下の「JavaScript」を選択します。
5. 「グローバルに実行」をオンにします。
6. 「エディタを開く」をクリックします。
7. 訪問者 ID サービスコードを追加します。
8. 上部に次のコードを追加し、「保存」をクリックします。

<br><br><br>// AppMeasurement を初期化
<br>var s_account=&quot;レポートスイート id&quot;
<br>var s=s_gi(s_account)
<br>/\*\*\*\*\*\*\*\*\*訪問者 ID サービス設定 — VisitorAPI.js が必要\*\*\*\*\*\*\*\*/
<br>s.visitor=Visitor.getInstance(&quot;Experience CloudID&quot;)<br><br><br>
<b>手順 6:アクションの追加 — ハートビートコード</b>

からの Heartbeat SDK のダウンロード [https://github.com/Adobe-Marketing-Cloud/media-sdks/tree/master/sdks/js/libs](https://github.com/Adobe-Marketing-Cloud/media-sdks/tree/master/sdks/js/libs).

ハートビートコードをダウンロードしたら、アクションの下の「 + 」ボタンをクリックして新しいアクション項目を作成し、次に

1. 「拡張機能」ドロップダウンから「コア」を選択します。
2. 「アクションタイプ」ドロップダウンから「カスタムコード」を選択します。
3. 「名前」テキストボックスにアクション名を追加します。
4. 「言語」の下の「JavaScript」を選択します。
5. 「グローバルに実行」をオンにします。
6. 「エディタを開く」をクリックします。
7. 訪問者 ID サービスコードを追加します。
8. 下部に次のコードを追加し、「保存」をクリックします。


//MediaHeartbeat クラスへのローカル参照を作成します

var MediaHeartbeat = ADB.va.MediaHeartbeat;var MediaHeartbeatConfig = ADB.va.MediaHeartbeatConfig;var MediaHeartbeatDelegate = ADB.va.MediaHeartbeatDelegate;

//メディアハートビートの初期化

var mediaConfig = new MediaHeartbeatConfig();mediaConfig.trackingServer = Configuration.HEARTBEAT.TRACKING_SERVER;mediaConfig.playerName = Configuration.PLAYER.NAME;mediaConfig.channel = Configuration.HEARTBEAT.CHANNEL;mediaConfig.debugLogging = Configuration.HEARTBEAT.DEBUG;

mediaConfig.appVersion = Configuration.HEARTBEAT.SDK;mediaConfig.ssl = Configuration.HEARTBEAT.SDK;mediaConfig.ovp = Configuration.HEARTBEAT.OVP;

// MediaHeartbeatDelegate プロトコルを実装します。
var mediaDelegate = new MediaHeartbeatDelegate();

// 初期設定

var appMeasurement = new AppMeasurement();appMeasurement.visitor = visitor;appMeasurement.trackingServer = Configuration.APP_MEASUREMENT.TRACKING_SERVER;appMeasurement.account = Configuration.APP_MEASUREMENT.RSID;appMeasurement.pageName = Configuration.APP_MEASUREMENT.PAGE_NAME;appMeasurement.charSet = Configuration.APP_MEASUREMENT.CHAR_SET;var contextData = { pageURL:document.URL, isUserLoggedIn:&quot;false&quot;, tvStation:「サンプル TV 局」，プログラマ：&quot;Khurshid Alam&quot; };var mediaInfo;var videostarted = false;var metaDataLoaded = false;



<b>手順 7:アクションの追加 — YouTube IFrame API コード</b>

1. 「拡張機能」ドロップダウンから「コア」を選択します。
2. 「アクションタイプ」ドロップダウンから「カスタムコード」を選択します。
3. 「名前」テキストボックスにアクション名を追加します。
4. 「言語」の下の「JavaScript」を選択します。
5. 「グローバルに実行」をオンにします。
6. 「エディタを開く」をクリックします。
7. 次のコードを追加し、「保存」をクリックします。


// 2. このコードは、 IFrame Player API コードを非同期で読み込みます。

var tag = document.createElement(&#39;script&#39;);tag.src = &quot;https://www.youtube.com/iframe_api&quot;;var firstScriptTag = document.getElementsByTagName(&#39;script&#39;)0;firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// 3. この関数は、API コードのダウンロード後に iframe( およびYouTube Player)//を作成します。

var player;function onYouTubeIframeAPIReady() { console.log(&quot;onYouTubeIframeAPIReady call...&quot;);       player = new YT.Player(&#39;player&#39;, { height:&#39;390&#39;、幅：&#39;640&#39;, videoId:&#39;xWYHvIjvMnY&#39;、events:{ &#39;onReady&#39;:onPlayerReady, &#39;onStateChange&#39;:onPlayerStateChange, &#39;onPlaybackQualityChange&#39;:onPlayerPlaybackQualityChange, &#39;onPlaybackRateChange&#39;:onPlayerPlaybackRateChange, &#39;onError&#39;:onPlayerError });}

// 4. API は、ビデオプレーヤーの準備が整ったら、この関数を呼び出します。

function onPlayerReady(event) { metaDataLoaded = true;       player.playVideo();}

// 5. プレーヤーの状態が変更されると、API はこの関数を呼び出します。
//関数は、ビデオの再生時 (state=1)、//プレーヤーが 6 秒間再生してから停止することを示します。

function onPlayerStateChange(event) { switch (event.data){ case YT.PlayerState.PLAYING:  console.log(&quot;\*\*\*HB Playing&quot;);                     if(metaDataLoaded){ if (Math.floor(event.target.getCurrentTime())) == 0) { console.log(&quot;\*\*\*HB Start&quot;);                                   MediaHeartbeat = ADB.va.MediaHeartbeat;                                   mediaInfo = MediaHeartbeat.createMediaObject( event.target.getVideoData().title, event.target.getVideoData().video_id, Math.floor(event.target.getDuration()), MediaHeartbeat.StreamType.VOD );                                     MediaHeartbeat = new MediaHeartbeat(mediaDelegate, mediaConfig, appMeasurement);                                   mediaDelegate.getCurrentPlaybackTime = function() { return Math.floor(event.target.getCurrentTime());                           };                                   MediaHeartbeat.trackSessionStart(mediaInfo, contextData);                                   MediaHeartbeat.trackPlay();                                   videostarted = true;                     } else { console.log(&quot;\*\*\*HB Play&quot;);                           MediaHeartbeat.trackPlay();                     }}break;              case YT.PlayerState.PAUSED:                     console.log(&quot;\*\*\*HB Pause&quot;);                     MediaHeartbeat.trackPause();                     壊す              case YT.PlayerState.ENDED:                     console.log(&quot;\*\*\*HB Ended&quot;);                     MediaHeartbeat.trackComplete();                     MediaHeartbeat.trackSessionEnd();                     壊す              ケース —1:                     console.log(&quot;\*\*\*HB Unloaded&quot;);                     MediaHeartbeat.trackComplete();                     MediaHeartbeat.trackSessionEnd();                     壊す       }

}

function onPlayerPlaybackQualityChange(event) { console.log(&quot;onPlayerPlaybackQualityChange:event.data:&quot;+ event.data);}

function onPlayerPlaybackRateChange(event) { console.log(&quot;onPlayerPlaybackRateChange:event.data:&quot;+ event.data);}

function onPlayerError(event) { console.log(&quot;onPlayerError:event.data:&quot;+ event.data);}



<b>手順 8:追加HTML</b>

次のコードをHTMLコードに追加します。

!-- 1. iframe（およびビデオプレーヤー）がこの div タグを置き換えます。 — div id=&quot;player&quot;/divbr

<b>手順 8:公開</b>

プロパティを公開し、テストします。


