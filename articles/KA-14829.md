---
title: Campaign ClassicV7 - db モジュール pg_stat_statements とは何ですか。 何のため？
description: 説明
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: https://wiki.corp.adobe.com/pages/viewpage.action?spaceKey=neolane&title=Database+performance+optimization+-+Identify+bottleneck+queries+with+execution+statistics#Databaseperformanceoptimization-Identifybottleneckquerieswithexecutionstatistics-pg_stat_statements
bug: false
article-created-by: Marta Zator
article-created-date: 5/4/2022 4:36:53 PM
article-published-by: Marta Zator
article-published-date: 5/4/2022 4:38:25 PM
version-number: 2
article-number: KA-14829
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=aa74c765-c8cb-ec11-a7b5-6045bd00d4f5
exl-id: ad0f34e4-bf33-4eef-a290-7b0a3e92a6c9
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '350'
ht-degree: 1%

---

# Campaign ClassicV7 - db モジュール pg_stat_statements とは何ですか。 何のため？

## 説明


1. db モジュール pg_stat_statements とは何ですか。

2. クライアントから有効にするように要求されるのはなぜですか？

3. どのように有効化されますか？






## 解像度




1.  pg_stat_statements モジュールは、サーバが実行するすべての SQL ステートメントの実行統計を追跡する手段を提供します。

このモジュールは、postgresql.conf の shared_preload_libraries に pg_stat_statements を追加してロードする必要があります。追加の共有メモリが必要なためです。 つまり、モジュールを追加または削除するには、サーバーを再起動する必要があります。

リンク： [https://www.postgresql.org/docs/9.4/pgstatstatements.html](https://www.postgresql.org/docs/9.4/pgstatstatements.html)



2. このテーブルにビュータイプのスキーマを実装すると、時間のかかるクエリを監視できます。 これにより、クライアントはそれらを調整し、パフォーマンスを最適化できます。

この拡張機能は、実行中のクエリに関する指標を提供します。最も頻繁に実行されるクエリであり、それぞれにかかる時間がどれくらいかを示します。



3.  <b>pg_stat_statements </b>

1. postgres バージョンの公式 PostgreSQL contrib パッケージがインストールされていることを確認します。

$ dpkg -l | grep postgres postgresql-contrib-9.3

インストールされていない場合は、インストールします。

$ apt-get install postgresql-contrib-9.3

2. postgresql.conf を変更して、起動時にモジュールをプリロードします。

デフォルト：shared_preload_libraries = &quot;新規：shared_preload_libraries = &#39;pg_stat_statements&#39; — pg_stat_statements と auto_explain の両方を使用する場合は、ONE レコードを使用し、コンマで区切り、shared_preload_libraries = &#39;auto_explain,pg_stat_statements&#39;を使用します。

3. 監視するデータベースで、 CREATE クエリを実行します。

— auto_explain に拡張を作成する必要はありません。pg_stat_statements psql postgres=# \c mydatabase mydatabase=# CREATE EXTENSION pg_stat_statements；の場合のみ、pg_stat_statements に拡張を作成します。

4. postgresql.conf の CUSTOMIZEDOPTIONSセクションで、次の行を追加します。

pg_stat_statements.max = 5000 pg_stat_statements.track = all pg_stat_statements.save = on

5. postgresql サービスを再起動する例：データベースで最もコストの高い上位 5 件のクエリを取得

SELECT query, calls, total_time, rows, 100.0\*shared_blks_hit/nullif(shared_blks_hit+shared_blks_read,0) pg_stat_statements からの AS hit_percent を d.oid = s.dbid で、d.datname = &#39;Database_Name&#39; order by total_time desc 5;
