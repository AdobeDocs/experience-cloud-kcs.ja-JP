---
title: 読み取り専用ファイル
description: 説明
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:23:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:18:00 PM
version-number: 1
article-number: KA-17483
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=88d504a5-9332-ec11-b6e5-000d3a5ba97a
exl-id: ccc49009-5cc4-48d5-84a3-3f7283afb1ca
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '867'
ht-degree: 1%

---

# 読み取り専用ファイル

## 説明

ドキュメントでは、どのファイルがロックされ、変更されないようにし、適切な設定を行う方法を説明します。<br><br> <br><br><br><br><br>なぜ？<br><br><br><br> <br><br>
AMS がシステムをプロビジョニングする際に、すべてが機能し、安全になるベースライン設定を展開します。  AMS では、機能とセキュリティの基本として常に保証したいとは思っていません。  これを実現するために、一部のファイルは読み取り専用としてマークされ、変更を避けるために不変となっています。

レイアウトを使用しても、動作を変更したり、必要な変更を上書きしたりすることはできません。  これらのファイルを変更する代わりに、元のファイルに代わる独自のファイルをオーバーレイします。

これにより、AMS が最新の修正とセキュリティ強化を含む Dispatcher にパッチを適用しても、ファイルが変更されないことを確認できます。  その後も、改善点のメリットを活用し、必要な変更のみを採用できます。
![ボールがレーンを下りていくボーリングレーンを表示します。  ボールには、「あなた」という単語が付いた矢印があります。  樋のバンパーは上に上がり、その上に「不変ファイル」という単語があります。](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/bowling-file-immutability.png "ボウリングファイル不変性")<br><br><br><br> <br><br>
上の図で示すように、不変ファイルは、ゲームを再生するのを止めていません。  彼らは、あなたのパフォーマンスを傷つけるのを止め、あなたを車線に留める。  この方法では、次の主要な機能をいくつか利用できます。

- カスタマイズは、独自の安全なスペースで処理されます
- カスタム変更のオーバーレイは、AEMのオーバーレイメソッドのオーバーレイを反映しています
- AMS 設定のパッチ適用は、カスタマイズを変更して実行できます
- 基本インストールとカスタマイズされた設定のテストを同時に実行して、問題がカスタマイズや他の原因によって発生しているかどうかを確認できます

<br><br><br><br>どのファイル？<br><br><br><br> <br><br>
以下に、Dispatcher と共にデプロイされる一般的なファイルのリストを示します。
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/``├── conf``│   └── httpd.conf``├── conf.d``│   ├── available_vhosts``│   │   ├── 000_unhealthy_author.vhost``│   │   ├── 000_unhealthy_publish.vhost``│   │   ├── aem_author.vhost``│   │   ├── aem_flush.vhost``│   │   ├── aem_health.vhost``│   │   ├── aem_lc.vhost``│   │   └── aem_publish.vhost``│   ├── dispatcher_vhost.conf``│   ├── enabled_vhosts``│   │   ├── aem_author.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_author``.vhost``│   │   ├── aem_flush.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_flush``.vhost``│   │   ├── aem_health.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_health``.vhost``│   │   └── aem_publish.vhost -``/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost``│   ├── logformat.conf``│   ├── remoteip.conf``│   ├── rewrites``│   │   ├── base_rewrite.rules``│   │   └── xforwarded_forcessl_rewrite.rules``│   ├── security.conf``│   ├── variables``│   │   └── ams_default.vars``│   └── whitelists``│       └── 000_base_whitelist.rules``├── conf.dispatcher.d``│   ├── available_farms``│   │   ├── 000_ams_author_farm.any``│   │   ├── 001_ams_lc_farm.any``│   │   └── 999_ams_publish_farm.any``│   ├── cache``│   │   ├── ams_author_cache.any``│   │   ├── ams_author_invalidate_allowed.any``│   │   ├── ams_publish_cache.any``│   │   └── ams_publish_invalidate_allowed.any``│   ├── clientheaders``│   │   ├── ams_author_clientheaders.any``│   │   ├── ams_common_clientheaders.any``│   │   ├── ams_lc_clientheaders.any``│   │   └── ams_publish_clientheaders.any``│   ├── dispatcher.any``│   ├── enabled_farms``│   │   ├── 000_ams_author_farm.any -``/etc/httpd/conf``.dispatcher.d``/available_farms/000_ams_author_farm``.any``│   │   └── 999_ams_publish_farm.any -``/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any``│   ├── filters``│   │   ├── ams_author_filters.any``│   │   ├── ams_lc_filters.any``│   │   └── ams_publish_filters.any``│   ├── renders``│   │   ├── ams_author_renders.any``│   │   ├── ams_lc_renders.any``│   │   └── ams_publish_renders.any``│   └── vhosts``│       ├── ams_author_vhosts.any``│       ├── ams_lc_vhosts.any``│       └── ams_publish_vhosts.any``├── conf.modules.d``│   ├── 01-cgi.conf``│   └── 02-dispatcher.conf``└── modules - ../..``/usr/lib64/httpd/modules``   ``└── mod_dispatcher.so` |
| --- |


不変ファイルを判断するには、Dispatcher で次のコマンドを実行して、
<br><br><br><br><br> <br><br><br><br>

| 1 | `$ lsattr -Rl``/etc/httpd` `2``/dev/null` `|``grep` `Immutable` |
| --- | --- |

<br><br><br><br><br> <br><br>
次に、不変ファイルに対する応答のサンプルを示します。
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/conf/httpd``.conf   Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_author``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_lc``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_flush``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/aem_health``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/000_unhealthy_author``.vhost Immutable``/etc/httpd/conf``.d``/available_vhosts/000_unhealthy_publish``.vhost Immutable``/etc/httpd/conf``.d``/rewrites/base_rewrite``.rules Immutable``/etc/httpd/conf``.d``/rewrites/xforwarded_forcessl_rewrite``.rules Immutable``/etc/httpd/conf``.d``/whitelists/000_base_whitelist``.rules Immutable``/etc/httpd/conf``.d``/dispatcher_vhost``.conf Immutable``/etc/httpd/conf``.d``/logformat``.conf Immutable``/etc/httpd/conf``.d``/security``.conf Immutable``/etc/httpd/conf``.modules.d``/02-dispatcher``.conf Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/000_ams_author_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/available_farms/001_ams_lc_farm``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_author_cache``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_author_invalidate_allowed``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_publish_cache``.any Immutable``/etc/httpd/conf``.dispatcher.d``/cache/ams_publish_invalidate_allowed``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_author_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_publish_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_common_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/clientheaders/ams_lc_clientheaders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_author_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_publish_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/filters/ams_lc_filters``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_author_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_publish_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/renders/ams_lc_renders``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_author_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_publish_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/vhosts/ams_lc_vhosts``.any Immutable``/etc/httpd/conf``.dispatcher.d``/dispatcher``.any Immutable` |
| --- |



## 解像度

<br><br>変更方法<br><br><br><br> <br><br>変数<br><br><br><br> <br><br>
変数を使用すると、設定ファイル自体を変更せずに、機能を変更できます。  設定の特定の要素は、変数の値を調整して調整できます。  ファイルからハイライトできる例を 1 つ示します。 */etc/httpd/conf.d/dispatcher_vhost.conf* は次のように表示されます。
<br><br><br><br><br> <br><br><br><br>

| `Include /etc/httpd/conf.d/variables/ams_default.vars````IfModule` &#39;disp_apache2.c``    ``DispatcherConfig.dispatcher.d/dispatcher.any``    ``DispatcherLog logs/dispatcher.log``    ``DispatcherLogLevel ${DISP_LOG_LEVEL}``    ``DispatcherDeclineRoot 0``    ``DispatcherUseProcessedURL 1``/``IfModule&quot;` |
| --- |

<br><br><br><br><br> <br><br>
所要時間 <b>DispatcherLogLevel</b> ディレクティブには、通常の値の代わりに DISP_LOG_LEVEL の変数が含まれます。  コードのこのセクションの上には、変数ファイルに対する include ステートメントも表示されます。  変数ファイル */etc/httpd/conf.d/variables/ams_default.vars*は、次に見たい場所です。  その変数ファイルの内容を次に示します。
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7 | `Define DISP_LOG_LEVEL info``Define AUTHOR_WHITELIST_ENABLED 0``Define PUBLISH_WHITELIST_ENABLED 0``Define LIVECYCLE_WHITELIST_ENABLED 0``Define AUTHOR_FORCE_SSL 1``Define PUBLISH_FORCE_SSL 0``Define LIVECYCLE_FORCE_SSL 1` |
| --- | --- |

<br><br><br><br><br> <br><br>
DISP_LOG_LEVEL 変数の現在の値が info である場合。  これを調整して、トレースやデバッグ、または選択した数値/レベルを追跡したり、デバッグしたりできます。  では、がログレベルを制御するすべてのが自動的に調整されます。
<br><br><br><br> <br><br>Overlay メソッド<br><br><br><br> <br><br>
詳しくは、 [上位レベルのインクルードファイル](https://helpx.adobe.com/experience-manager/kb/ams-dispatcher-manual/explanation-config-files.html#include-order) カスタマイズを開始するには、これらを使用する必要があります。  簡単な例から始めるために、この Dispatcher を指す新しいドメイン名を追加するシナリオがあります。  使用するドメインの例は、です。 <b>we-retail.adobe.com </b> まず、既存の設定ファイルを新しい設定ファイルにコピーし、そこで変更を追加します。
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cp` `/etc/httpd/conf``.d``/available_vhosts/aem_publish``.vhost``/etc/httpd/conf``.d``/available_vhosts/weretail_publish``.vhost` |
| --- | --- |

<br><br><br><br><br> <br><br>
既存の *aem_publish.vhost* ファイルを作るのは既に何かを作る必要があるものを持っていて、すでに強力なスタートを作り直したくないからです。  次に、新しい *weretail.vhost* ファイルを作成し、必要な変更を加えます。

前:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7<br>  8<br>  9<br>  10<br>  11<br>  12<br>  13 | `VirtualHost *:80``    ``ServerName    publish``    ``ServerAlias    ${PUBLISH_DEFAULT_HOSTNAME}``    ``DocumentRoot    ${PUBLISH_DOCROOT}``    ``IfModule mod_headers.c``            ``Header always add X-Dispatcher ${DISP_ID}``            ``Header always add X-Vhost "publish"``            ``Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"``            ``Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"``        ``Header append Vary User-Agent env=!dont-vary``    ``/IfModule``....... SNIP.......``/VirtualHost` |
| --- | --- |

<br><br><br><br><br> <br><br>
後：
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7<br>  8<br>  9<br>  10<br>  11<br>  12<br>  13 | `VirtualHost *:80``    ``ServerName    weretail-publish``    ``ServerAlias    we-retail.adobe.com``    ``DocumentRoot    ${PUBLISH_DOCROOT}``    ``IfModule mod_headers.c``            ``Header always add X-Dispatcher ${DISP_ID}``            ``Header always add X-Vhost "werteail-publish"``            ``Header merge X-Frame-Options SAMEORIGIN "expr=%{resp:X-Frame-Options}!='SAMEORIGIN'"``            ``Header merge X-Content-Type-Options nosniff "expr=%{resp:X-Content-Type-Options}!='nosniff'"``        ``Header append Vary User-Agent env=!dont-vary``    ``/IfModule``....... SNIP.......``/VirtualHost` |
| --- | --- |

<br><br><br><br><br> <br><br>
これで、新しいドメイン名と他のパンくずヘッダーを更新するだけでなく、新しいドメイン名と一致するように ServerName と ServerAlias を更新しました。  次に、新しいファイルを有効にして、Apache が新しいファイルを使用することを知らせるようにします。
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cd` `/etc/httpd/conf``.d``/enabled_vhosts/``;``ln` `-s ..``/available_vhosts/weretail_publish``.vhost .` |
| --- | --- |

<br><br><br><br><br> <br><br>
Apache Web サーバーは、ドメインがトラフィックを生成するものであることを認識していますが、Dispatcher モジュールに対して、受け入れる新しいドメイン名を持つことを通知する必要があります。  まず、新しい\*_vhost.any ファイルを作成します。 <b>/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any</b> そのファイル内に、受け入れたいドメイン名を入れます。
<br><br><br><br><br> <br><br><br><br>

| 1 | `"we-retail.adobe.com"` |
| --- | --- |

<br><br><br><br><br> <br><br>
次に、新しい vhost エントリファイルを使用する新しいファームファイルを作成する必要があります。まず、新しいファイルに強力な開始ファイルをコピーします。
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cp` `/etc/httpd/conf``.dispatcher.d``/available_farms/999_ams_publish_farm``.any``/etc/httpd/conf``.dispatcher.d``/available_farms/400_weretail_publish_farm``.any` |
| --- | --- |

<br><br><br><br><br> <br><br>
このファームファイルに加える必要のある変更を表示します

前:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6 | `/publishfarm { ``    ``/virtualhosts {``        ``$include "/etc/httpd/conf.dispatcher.d/vhosts/ams_publish_vhosts.any"``    ``}``........SNIP.........``}` |
| --- | --- |

<br><br><br><br><br> <br><br>
後：
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6 | `/weretailpublishfarm { ``    ``/virtualhosts {``        ``$include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any"``    ``}``........SNIP.........``}` |
| --- | --- |

<br><br><br><br><br> <br><br>
ファーム名を更新し、ファーム設定の/virtualhosts セクションで使用するインクルードを作成しました。  この新しいファームファイルを有効にして、実行中の設定で使用できるようにする必要があります。
<br><br><br><br><br> <br><br><br><br>

| 1 | `$``cd` `/etc/httpd/conf``.dispatcher.d``/enabled_farms/``;``ln` `-s ..``/available_farms/400_weretail_publish_farm``.any .` |
| --- | --- |

<br><br><br><br><br> <br><br>
Web サーバーサービスを再読み込みし、新しいドメインを使用します。

注釈:

変更したのは、ベースライン設定ファイルに付属の既存のインクルードとコードを変更して活用するために必要な部分だけです。  必要な要素を説明するだけです。  より簡単になり、より少ないコードを維持できます
