---
title: 「AEM Thread Dump Analysis」
description: 説明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html"
bug: false
article-created-by: Emily Geary
article-created-date: "3/17/2021 9:11:03 PM"
article-published-by: Emily Geary
article-published-date: "3/17/2021 9:13:37 PM"
version-number: 2
article-number: KA-16458
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e70a8345-6587-eb11-a812-000d3a593216"
exl-id: 74bb70e4-a09b-48fc-8378-96a1736e5ebf
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1002'
ht-degree: 1%

---

# AEM Thread Dump Analysis

## 説明


次を使用してAEM Java スレッドダンプを分析 [IBM Thread Analyzer](http://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) ツール


## 解像度


1. ダウンロードとインストール [IBM Thread Analyzer](https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) ( つまりIBM TDA と呼ぶ )
2. Capture [スレッドダンプ](https://helpx.adobe.com/jp/experience-manager/kb/TakeThreadDump.html) パフォーマンスの問題が発生しているAEMインスタンスから。
3. IBM TDA でスレッドダンプを開きます。
4. スレッドダンプの詳細を表示するには、リスト内のファイルを選択し、「スレッドの詳細」ボタンをクリックします。

![tda-threaddetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1587732783/tda-threaddetail.png "tda-threaddetail")
5.最も長いスタックを上に持つ「スタックの深さ」で並べ替えます。

![tda-image1](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image/tda-image1.png)
6.スタックの深さが 10 行以上のスレッドを確認します。  これらは通常、最も興味深いスレッドです。  関心のあるスレッドに関するメモを取ります。
7.スレッドで並べ替え「状態」 8. 「実行可能」スレッドまで下にスクロールします。 実行可能スレッドとは、スレッドダンプが取得されたときに CPU 時間を積極的に取り上げていたスレッドです。

*注意：「実行可能」スレッドを確認する際に、 [無視できるスレッド](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html#ignorethreads) 」セクションをクリックします。*
9.アプリケーションの一部である実行可能なスレッドを見つけます。例えば、バックグラウンドジョブスレッドやリクエストスレッド（リクエストスレッドには次のような名前が付けられます） *127.0.0.1 1347028187737GET/content/sites/global/en/sitemap.static-delivery.httpd.html HTTP/1.1*) をクリックします。 見つかったら、1 つずつクリックします。
10.各リクエストスレッドについて、スレッド名のタイムスタンプを調べることで、ユーザーのブラウザーがいつサーバーにリクエストを送信したかを確認できます。  例えば、上記のスレッド名では、タイムスタンプ（ミリ秒 UNIX エポック形式）は1347028187737です。  このエポック番号は、 [www.epochconverter.com](http://www.epochconverter.com/).  各スレッドダンプは、実行された日時を示します。  リクエスト時間とスレッドダンプ時間の間の時間差を取り、リクエストがアクティブになっている時間を確認できます。
11.要求スレッドを確認した後、他の「実行可能」スレッドをスクロールします。  「実行可能」なスレッドを見つけたら、中央のパネル、「待機中のスレッド」を見てください。  一覧に表示されたスレッドは、選択したスレッドがモニタを解放するのを待っています。  待機中のスレッドが見つからない場合、選択したスレッドは、 [ロック](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) （クラスの実装を参照） [ロック](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) を参照 )。 例えば、 [ReentrantReadWriteLock](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html) ロックが複数のモニタを内部的に実装するので、どのスレッドがロックホルダかは判別できません。  だから、ソースコードを見て、ロックホルダーのスレッドと照合しなければならないかもしれません。
12.他の多くのスレッドが待機していたロックまたはモニタがスレッドにあった場合は、その後のスレッドダンプを通じて、同じ問題を持つ他のスレッドを見つけられるかどうかを確認します。  他のダンプに同じスレッドがまだ存在するかどうかを確認します (IBM TDA では、複数のスレッドダンプを選択し、「スレッドを比較」ボタンをクリックして、複数のスレッドダンプにわたるスレッドの状態を表示できます。

![tda-comparethreads](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1159496390/tda-comparethreads.png)
13.以下のスクリーンショットの「コレクタサービス」を参照してください。

![tda-Image2](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1730877898/tda-Image2.png)
14.このビューでは、複数のスレッドダンプをまたいでスレッドを見て、長い実行スレッドであるかどうかを確認できます。  基本的に、スレッドが複数のダンプで実行可能状態で、長いスタックを持つ場合は、通常は長い実行スレッドです。
15.実行可能なスレッドをあまり見つけていない場合は、スレッドのリストに戻り、スレッドダンプを選択し、上部のパネルにある「詳細を監視」ボタンをクリックします。 IBM TDA は、モニタの所有スレッドとその待機スレッドのツリービューを示すウィンドウを開きます。 注意：サーブレットエンジンのスレッドプールモニターのようなスレッドプールスレッドが表示される場合があり、アイドルスレッドは無視できます。  通常、スレッドはアイドルスレッドプールのスレッドであることを示すことができます。これは、ほとんどの場合、10 個以下のスタックラインしかないためです。

![tda-monitordetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1106466084/tda-monitordetail.png)




<b>スレッドレベルの CPU 使用率（Linux プラットフォームのみ）:</b>

1. 「top -H -b -n1 -p javapid」出力をスレッドダンプに加えてキャプチャした場合、スレッドレベルの CPU 使用率を相互参照できます。  上部の出力を開き、CPU を使用しているスレッドのプロセス ID を取得します。  プロセス ID を 16 進数に変換し、対応するスレッドダンプファイルでその 16 進数値を検索します。  id は、いずれかのスレッドの「nid」と一致する必要があります。
2. 最も多くの CPU を使用する一致するスレッドが「VM スレッド」または任意の「GC」スレッドの場合は、メモリの問題が発生する可能性があります。  CPU 時間を要するスレッドのパターンがある場合は、メモリに問題が発生します。
3. メモリの問題を確認した場合は、次に問題が発生したときにヒープダンプをキャプチャします。  詳しくは、 [この記事](https://helpx.adobe.com/experience-manager/kb/AnalyzeMemoryProblems.html) ヒープダンプのキャプチャと分析の詳細については、を参照してください。


![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)

無視できるスレッド：

- VM スレッド：これは VM システムスレッドです。
- GC タスクスレッドで始まるスレッド：これらはガベージコレクションスレッドです。
- java.net.PlainSocketImpl.socketAccept(Native Method) のコード内の — 1347028691218に似た名前のスレッド：これらは、新しい接続で待機しているサーブレットエンジンのスレッドプールからのスレッドです。
