---
title: 異常なリポジトリの増加を分析
description: 説明
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager 6.4,Experience Manager 6.5
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 9:42:02 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:45:04 PM
version-number: 1
article-number: KA-17496
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=6654cfb6-b732-ec11-b6e5-000d3a5ba97a
exl-id: 51d503fe-3da6-4cfc-a8c5-95f80da51ae8
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '534'
ht-degree: 3%

---

# 異常なリポジトリの増加を分析

## 説明


AEMサーバー上では、ディスク使用量が異常に急速に増加しています。
<br><br><br><br>原因<br><br><br><br><br><br>
多くの点で、ディスク使用率が異常に増加する可能性があります。  考えられる原因：

1. システム上で適切なメンテナンスが実行されていません。  詳しくは、 [この記事](https://helpx.adobe.com/jp/experience-manager/kb/AEM6-Maintenance-Guide.html) を参照してください。
2. AEMまたはアプリケーションが、ノードプロパティに対して多数のノードまたは更新を作成しています。  これは、設定の誤りやアプリケーションコードのバグが原因である可能性があります。  Oak の tar ストレージは追加専用モードで動作するので、ノードを繰り返し保存すると、リポジトリの過剰な増加に寄与します。
3. 非常に大きなファイルがAEM Assetsまたはパッケージマネージャーにアップロードされました。
4. デバッグまたはトレースのログが有効のままになりました。



## 解像度

A. AEMが実行中で、十分なディスク容量がある場合<br><br><br><br> <br><br>1. OAK 書き込みTRACEログの設定<br><br><br><br> <br><br>AEMがまだ実行中の場合は、デバッグロガーを有効にして、書き込み先のリポジトリパスを指定できます。  このロガーを有効にするには、次の手順に従って、添付のログ設定パッケージをインストールするか、次の手順に従います。
1. に移動します。 <b>*http://aemhost:port*/system/console/slinglog</b>
2. クリック <b>[!UICONTROL 新しいロガーを追加]</b>
3. ロガーの設定： <b>[!UICONTROL ログファイル]: `logs/repgrowth.log`</b>, <b>[!UICONTROL ログレベル]: `trace`</b>, <b>[!UICONTROL ロガー]:</b> <b>`org.apache.jackrabbit.oak.jcr.operations.writes`</b>


ダウンロード
[ファイルを取得](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/analyze-unusual-repository-growth/jcr:content/main-pars/download/log_repository_growth-1.zip "log_repository_growth-1.zip") <br><br>このパッケージには、Oak のログ書き込みセッションに必要な設定が含まれています。 CRX パッケージマネージャーを使用して、このパッケージをインストールします。 監視期間が経過したら、必ずパッケージをアンインストールしてください。<br><br><br><br><br><br><br><br> <br><br><br><br><br><br> <br><br><br><br><br><br><br><br><br>
注意：

- ログには、すべての書き込みとセッションの詳細に関する情報が含まれます。  このロガーを使用する場合は、十分なディスク容量があることを確認してください。
- これを有効にしてから短時間の後に、ログ設定パッケージをアンインストールするか、ログ設定を削除して、ディスク容量の消費を抑えます。



<br><br><br><br> <br><br>2. ディスク使用量レポートの実行<br><br><br><br> <br><br>
また、 [!UICONTROL ディスク使用量] レポート <b>*http://host:port*/etc/reports/diskusage.html</b>このレポートは、リポジトリパスで使用されているディスク領域を表示します。  レポートはドリルダウン可能で、サブツリーも表示できます。
<br><br><br><br> <br><br>3. スレッドダンプのキャプチャとプロファイルの実行<br><br><br><br> <br><br>
使用後 <b>[repgrowth.log](https://helpx.adobe.com/experience-manager/kb/analyze-unusual-repository-growth.html#repgrowth)</b> どのデータが書き込まれているかを知るには、スレッドダンプをキャプチャし、CPU プロファイルを実行することで、どのコードがそのデータを書き込んでいるかに関する情報を取得します。

次の記事を参照してください。

- [CPU プロファイル](https://helpx.adobe.com/jp/experience-manager/kb/AnalyzeUsingBuiltInProfiler.html)
- [スレッドダンプのキャプチャ](https://helpx.adobe.com/jp/experience-manager/kb/TakeThreadDump.html)
- [AEMスレッドダンプの分析](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html)

<br><br><br><br> <br><br>B. AEMが停止し、ディスク容量がほぼ不足している場合<br><br><br><br> <br><br>
ディスク容量の増加を防ぐためにAEMを停止した場合は、以下のコマンドを使用して初期分析を行います。

オン [!DNL Linux] プラットフォームでは、 <b>`du`</b> の下のすべてのディレクトリをリストするコマンド <b>`crx-quickstart`</b> これらのディレクトリの要約されたサイズで、

`du -h --max-depth=2 crx-quickstart`

用途 <b>`find`</b> および <b>`du`</b> 最近変更したファイルを検索し、そのサイズを取得するコマンド：

`find crx-quickstart -type f -mtime 1 -exec du -hs {} \; -print`

データストアで大きなファイルを検索するには、 <b>`find`</b>, <b>`du`</b> および <b>`file`</b> 100 MB を超えるファイルを <b>`datastore`</b> ディレクトリを開き、ファイルタイプを自動識別します。

`find crx-quickstart/repository/datastore -type f -size +100M -exec sh -c "du -hs \"{}\"; file \"{}\"" \;`

もし成長が <b>`segmentstore`</b> 次のコマンドは、どのデータが書き込まれているかに関するヒントを与えるのに役立ちます。

`strings data_xxxxxx.tar | egrep '.?/' | sed 's/.$//;s/.\//\//'`
