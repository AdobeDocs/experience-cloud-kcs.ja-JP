---
title: を使用した SMPP プロトコル分析 [!DNL Wireshark]
description: 説明
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS、SMPP、Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 4%

---

# を使用した SMPP プロトコル分析 [!DNL Wireshark]

## 説明

<br>以下を使用して SMPP トラフィックを分析する方法を説明します。 [!DNL Wireshark].<br><br><br><br><br>はじめに<br><br><br><br> <br><br>
ほとんどの高スループット SMS-C は、SMPP プロトコルバージョン 3.4 と互換性があります。このプロトコルを使用すると、SMS の送信とこれらの SMS の配信に関する情報の受信が可能になります。 SMPP プロトコルは、インターネット上でPDFドキュメントとして使用できる SMPP プロトコル仕様 v3.4 に記載されています。

この記事は、この仕様の代替品ではありません。これは、プロトコル仕様を解釈し、それを [!DNL Wireshark] が表示され、Adobe Campaignと SMS-C パートナー間の問題のトラブルシューティングに役立ちます。

SMPP プロトコルには実装チームの解釈に残された様々な部分が多数含まれているので、SMS-C は異なります。

問題のトラブルシューティングを行う場合は、SMS-C パートナーに連絡して情報を取得したり、入手した情報を再確認したりします。 SMS-C がエラーで返信する場合、SMS-C パートナーは、エラーで返信した理由を知るのに最適なユーザーです。 実際の SMS-C に接続する代わりに SMPP シミュレーターを使用している場合は、ソースコード（またはデバッガー）を使用して、何が起きているかを理解する必要があります。


## 解像度

<br><br>を使用しないネットワークトラフィックのキャプチャ [!DNL Wireshark]<br><br><br><br><br><br>
マシンに直接アクセスできない場合は、次のようなコマンドラインツールを使用してキャプチャする必要がある場合があります。 *tcpdump*. 接続の TCP ポートが既にわかっている場合は、すべてのトラフィックをキャプチャしないように、正しいフィルターを設定します。 以下にサンプルを示します `tcpdump` ポートをキャプチャするためのコマンドライン `12345` から <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


ファイル <b>`outfile.pcap`</b> その後、で開くことができます。 [!DNL Wireshark] を参照してください。


<br><br>[!DNL Wireshark] 取り扱い<br><br><br><br> <br><br><br><br>
このトピックは、の基本を理解していることを前提としています。 [!DNL Wireshark]:パケットのキャプチャ、単純なフィルタの定義、パケットの詳細の読み取り。 以下に簡単な紹介を示します。 [howtogeek — 使い方 [!DNL Wireshark] キャプチャ、フィルタ、およびInspectパケット](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

で SMPP トラフィックを除外するには、以下を実行します。 [!DNL Wireshark]には、次の 3 つの重要な機能があります。

- SMS-C のポートで表示フィルターを使用します。例えば、SMS-C がポートを使用する場合は、 `10000`、次のフィルターを使用します。
   *`tcp.port == 10000`*


電話番号またはテキストコンテンツでパケットを分離するには、次の設定で検索機能を使用します。
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- 以下を使用： <b>TCP ストリームに従う</b> ツールを使用して、作業中のストリームを分離します。
ポップアップ表示される赤/青のテキストウィンドウを閉じます。これは、SMPP とは関係のないテキストプロトコルでのみ役立つからです。
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>SMPP プロトコル<br><br> <br><br>
プロトコルは TCP 経由で動作し、完全にバイナリです。つまり、 [!DNL Wireshark] ストリームのコンテンツを復号化するには、 （または 16 進数エディター）が必要です。

ストリームは、独立した PDU で構成されます。各 PDU は、コマンド、ステータス、シーケンス番号、およびコマンドに基づくその他の情報を含むメッセージです。

ストリームプロトコルとしての TCP の性質上、TCP パケットに複数の PDU が含まれ、PDU が 2 つ以上の TCP パケットにまたがる場合があります。 [!DNL Wireshark] は PDU を正しく再アセンブリするので、 [!DNL Wireshark] ユーザー。

MT を送信し、SR を受け取ったときにネットワークを通過する PDU の例を次に示します。
![smpp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smpp3")
注意：

標準コマンドのリストは、SMPP 仕様（SMPP コマンドセット）の 5.1.2.1 節に記載されています。
<br><br><br><br><br><br>SMPP 応答<br><br><br><br> <br><br>
SMPP プロトコルでは、すべてのコマンドが応答 PDU によって確認される必要があります。

`BIND_TRANSMITTER` は次の点で認識されます： *`BIND_TRANSMITTER_RESP`*, *`SUBMIT_SM`* は次の点で認識されます： *`SUBMIT_SM_RESP`*&#x200B;など

応答にタイムアウトがあり、通常は 10 秒、30 秒、60 秒です。応答には正の確認応答 (`command _status = 0`) またはエラー（ 5.1.3 を参照） *`command_status`*, *表 5-2* （標準エラーのリストの SMPP 仕様）。 ほとんどの場合、これらの応答は即時におこなわれ、応答タイムアウトには達しません。

SMPP 応答エラーと SR エラーコードを必ず区別します。同じエラーコードが、応答エラーまたは SR エラーフィールドの異なることを意味する場合があります。 エラーコードを報告する際は、値の意味がコンテキストに依存するので、エラーコードの見つけ方には細心の注意を払う必要があります。
<br><br><br><br><br><br>SMPP 接続の初期化<br><br><br><br><br><br>
SMPP 接続は、TCP を使用して接続することから開始します。 その後、 `BIND` 操作の送信元 [!DNL Campaign]（によって確認された） `BIND RESP`. これらの操作については、SMPP 仕様の 4.1 節 (`BIND` 操作 )。
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
バインド操作は、ログイン/パスワードのチェックを行い、仕様に記載されているプラットフォーム名、バージョン、その他のフィールドに関する情報を交換します。

注釈:

ログイン情報は、 `system_id` フィールドに入力します。



In [!DNL Campaign]に設定されている場合、 *`BIND_TRANSMITTER`* MT 転送を開始する際にパケットを送信し、 *`BIND_RECEIVER`* 次の場合にパケットを送信 *`nlsm s`* トリガーと MO/SR 接続

<b>トランスミッター、レシーバー、およびトランシーバ： </b>Campaign Classic用の SMPP コネクタは、別のトランスミッター/レシーバーモードで機能します。2 つの TCP 接続があり、1 つは MT を送信する接続で、もう 1 つは MO と SR を受信する接続です。 TCP 接続は常に [!DNL Campaign]（レシーバーモードの場合も）

SMPP はトランシーバモードも提供しますが、このモードはCampaign Classic用の SMPP コネクタには実装されていません。

SMPP コネクタは、MT の送信に複数の接続を並行して使用します。 コネクタの設計方法が原因で、これを制御できません。
<br><br><br><br><br><br>MO の受信<br><br><br><br><br><br>
受信機がバインドされると、SMS-C はいつでも MO を送信できます。 MO は、 *`DELIVER_SM`* ビット 2～5 の PDU *`esm_clas s`* クリア（多くの場合） *`esm_class`* は 0 だけです )。
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
この *`DELIVER_SM`* PDU は、 *`DELIVER_SM_RESP`* 同じ PDU *`sequence_number`*.
<br><br><br><br><br><br>MT の送信<br><br><br><br><br><br>
MT を送信するには、トランスミッターが正常にバインドされている必要があります。 その他の処理を行う前に、バインド処理が正常に実行されたことを確認します。

MT は *`SUBMIT_SM`* PDU。 SMS-C は、 *`SUBMIT_SM_RESP`* PDU:この応答パケットは、SMS-C のデータベースにメッセージの ID が含まれているので特別です（SMS-C パートナーと話し合う際は、より迅速にメッセージを見つけられるようにこの ID を必ず含めてください）。 この ID は SR に存在し、MT を対応する SR と照合する唯一の方法です。

フィールド *`registered_delivery`* （仕様のセクション 5.2.17 で説明）は、SR がこの特定の MT に対して要求されているかどうかを SMS-C に示します。 特定のメッセージの SR を受け取らない場合は、 *`SUBMIT_SM`* PDU。
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>MT のエンコード<br><br><br><br><br><br>
注意：

SMS エンコーディングは、多くのトラップと様々な実装を備えた複雑な主体です。


<br><br><br><br> <br><br>
エンコードの問題が発生した場合は、必ず SMS-C パートナーに連絡することをお勧めします。 SMS パートナーは、サポートされるエンコーディングと、技術プラットフォームの制限により適用される可能性のある特別なルールに関する正確な知識を持っています。 何を送信し、何を送り返すかを確認するようにします。これは、正常で安定した相互接続への唯一のパスです。

SMS メッセージは、特殊な 7 ビットエンコーディングを使用します。通常、GSM7 エンコーディングと呼ばれます。参照： [!DNL Wikipedia] GSM 03.38（英語）。
<br><br><br><br> <br><br>
SMPP プロトコルでは、トラブルシューティングを容易にするために、GSM7 のテキストが 1 文字あたり 8 ビットに拡張されます。 SMS-C は、携帯電話に送信される前に、1 文字あたり 7 ビットにパックします。 つまり、SMS の short_message フィールドの長さは SMPP フレームで最大 160 バイトになりますが、モバイルネットワークで送信される場合は 140 バイトに制限されます（最も重要なビットは破棄されるだけです）。

エンコードの問題が発生した場合は、次の点を確認してください。

- まず、どの文字がどのエンコーディングに属するかを把握しておく必要があります。 GSM7 は、読み分け符号（アクセント記号）の部分的なサポートで悪名高いです。 フランス語の場合、é と è が GSM7 に含まれますが、ê、â、ï は含まれません。スペイン語に関しては、状況は良くありません。
- セディラが付いた C(ç) は、GSM7 アルファベットでは大文字のみで表示されますが、一部の携帯電話では小文字または「スマート」文字で表示されます。一般的に、この文字を完全に避け、セディラを削除する（フランス語ではまだ非常に読みやすい）か、UCS-2 に切り替えることをお勧めします。
- SMS-C パートナーから明示的に要求されない限り、SMS では ASCII を使用しないでください。このエンコーディングは、8 ビット文字で、GSM7 よりも有効範囲が少ないので、領域を浪費します。
- Latin-1 は常にサポートされているわけではありません。Latin-1 を使用する前に、SMS-C パートナーとの互換性を確認してください。
- 各国語シフトテーブルは、Adobe Campaign Classicコネクタではサポートされていません。 代わりに、UCS-2 を使用する必要があります。
- UCS-2 と UTF-16 は、多くの場合、携帯電話で混在します。これは、絵文字を送信する人や、UCS-2 に存在しないほとんど使用されない文字を送信する人にとって問題です。
- GSM7 エンコーディングは、 [!DNL Wireshark]:特殊文字は正しく表示されません。 GSM7 文字列が正しくエンコードされているかどうかを確認する必要がある場合は、16 進数コードと GSM7 テーブルを比較する必要があります。


この *`data_coding`* フィールドは、使用されるエンコーディングを示します。 唯一の問題は、値 0 が仕様内のデフォルトの SMS-C エンコーディングを意味し、一般に GSM7 を意味する点です。 SMS-C *パートナーにエンコーディングの関連付けを確認する `data_coding = 0` (Adobe Campaignは GSM7 for &lt;product or plug-in name> のみをサポートします。 `data_coding* = 0`) をクリックします。

メッセージの最大サイズは、エンコーディングによって異なります。次の表に、すべての関連情報をまとめます。
<br><br><br><br> <br>

| エンコード | data_coding | メッセージサイズ（文字）  | マルチパート SMS のパーツサイズ  | 使用可能な文字  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [GSM7 基本文字セット+拡張子](https://en.wikipedia.org/wiki/GSM_03.38) （拡張文字は 2 文字です）  |
| Latin-1  | 3 | 140 | 134 | ISO-8859-1 |
| UCS-2 UTF-16  | 8 | 70 | 67 | Unicode（携帯電話によって異なります） |

<br><br><br><br><br>ユーザーデータヘッダー (UDH)<br><br><br><br><br><br>
UDH（ユーザーデータヘッダー）は、SMS のテキストに追加される小さなバイナリヘッダーです。 SMS 連結、各国語シフトテーブル、ロゴ/画像（ほとんど使用されない）、WAP プッシュなどの特殊機能をトリガーできます。

UDH はテキストフィールド（short_message SMPP フィールド）の一部なので、SMS の有効なサイズを短縮します。 例えば、連結された SMS UDH では、SMS 部分ごとに 6 バイト（7 ビット文字ではなく、6 つの実際の 8 ビットバイト）を消費し、メッセージ部分ごとに 152 個の 7 ビット文字に対して十分な空き領域が残ります。

[!DNL Wikipedia] には、ユーザーデータヘッダーと連結 SMS に関する優れた記事があります（英語）。

short_message に UDH が含まれているかどうかを確認するには、esm_class のビット 6 と 7 を確認します（仕様の 5.2.12 を参照）。 [!DNL Wireshark] は UDH をインターフェイスで解析し、正確な情報を提供します。
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
上のスクリーンショットでは、メッセージフィールド (1) にユーザーデータヘッダー、UDH(2) に含まれる情報、およびパケットに属さないが計算された一部の追加情報を確認できます。 [!DNL Wireshark] (3):短いメッセージ本文フィールドは、 [!DNL Wireshark].
<br><br><br><br><br><br>SR の受信<br><br><br><br><br><br>
受信者がバインドされている場合、SMS-C はいつでも SR を送信できます。 SR は、ビット 2～5 の*の DELIVER_SM PDU を使用して送信されます`esm_class`*設定済み
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
この *`DELIVER_SM`* PDU は、 *`DELIVER_SM_RESP`* 同じ PDU *`sequence_number`*. この SR に一致する MT を見つけるには、 *`SUBMIT_SM_RESP`* を同じ ID に設定します。 例えば、SR に一致する MT は次のようになります。
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
SR は、 *`registered_delivery`* フィールドが MT に設定されている。

注釈:

Adobe Campaign Classic SMPP コネクタは、 *`SUBMIT_SM_RESP`* パケット。 この仕様では、この動作が明示的に禁止されていませんが、不正な動作と見なされます（メッセージが送信される前に受信されたことを意味します）。 このケースが頻繁に発生する場合は、SMS-C パートナーにプラットフォームの修正を依頼してください。
<br><br><br><br><br><br>SR の short_message フィールドの復号化<br><br><br><br><br><br>
SR PDU のテキストフィールドには、SMPP プロトコル仕様の付録 B に記載されている特別なエンコーディングがあります。 残念ながら、この形式はプロトコルの一部ではない推奨です。ほとんどの SMS-C は、この形式を多かれ少なかれ尊重しますが、この形式はプロトコルの一部ではありません。

SMS-C パートナーに直接独自の実装のドキュメントを求め、に表示される内容と一致することを再度確認する必要があります。 [!DNL Wireshark]. 多くの場合、SMS-C 実装担当者は実装を知らず、問題や誤解を引き起こします。 このフィールド（特にエラーコード）に疑問がある場合は、SMS-C パートナーに助けを求めることを躊躇しないでください。

基本的な形式は次のとおりです。

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

上記の行を読む際の一般的なガイドラインを次に示します。

- ID は、 *で送信されたものと同じです。`SUBMIT_SM_RESP`*対応する MT の
- 問題は `text` フィールド：このフィールドは次の場合は無視されます： [!DNL Campaign] これは役に立たず、信頼性も低く、SMS が純粋な英数字 ASCII 以外のエンコードで送信された場合は、完全に読み取れなくなる可能性もあるので、ご注意ください。 これは正常な動作です。
- フィールド名では大文字と小文字が区別されません ( 例： `id`: `sub`: `Text`:また、 `ID`: `SUB`: `text`:) です。
- *`dlvrd`*フィールドは、SMS-C パートナーによって文書化されていない限り、通常は信頼できません。
- 日付は、何らかのタイムゾーンを持つ場合があり、実際には役に立たないか、リモートサーバーのクロックがオフになっているため、単に間違っているだけです。
- *`stat`*フィールドには、付録 B で定義された値以外の値を持つことがあります。常識と SMSC パートナーのドキュメントを使用して、その意味を理解します。
- *`err`*フィールドは SMS-C に完全に依存し、ほとんどの場合 SMS-C パートナーによってドキュメントに記載されています。 多くの場合、コード 000 は成功を表し、他のコードはエラーを示します。 フィールドは多くの場合、数値ですが、16 進数を使用することもできます。

<br><br><br><br><br><br>同じ MT に対する複数の SR<br><br><br><br><br><br>
一部の SMS-C は、同じ MT に対して複数の SR を送信し、ネットワーク内の MT の進行を追跡します。 ほとんどの場合、クライアントはメッセージがいつ受信されたかしか知りたがらないので、これはほとんど役に立ちません（通常、最後の SR です）。

不明な場合は、SMS-C から受け取った最新の SR に対してのみ作業して、メッセージの状態を見つけます。
<br><br><br><br><br><br>SMPP ウィンドウ<br><br><br><br><br><br>
操作と応答は非同期なので、応答を待つ前に複数の操作 PDU を送信することで、転送率を最適化できます。 返信のないメッセージの数は、ウィンドウと呼ばれます。

最大ウィンドウが 4 の送信の例：
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
現在の実装では、ウィンドウは制御されず、リモート SMS-C が MT を処理するのに十分な速度であることを期待しています。
