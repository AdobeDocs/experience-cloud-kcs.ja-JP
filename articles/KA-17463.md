---
title: "Dispatcher バニティー URL"
description: 「AEMでバニティー URL を扱う方法や、書き換えルールを使用してコンテンツを配信の端に近づけるなどの追加の手法について説明します。」
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS，バニティ URL, AEM, experience manager, rewrite rules"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "4/8/2024 11:03:25 AM"
article-published-by: Nayanika Chakravarty
article-published-date: "4/8/2024 1:01:29 PM"
version-number: 5
article-number: KA-17463
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=4683d89c-97f5-ee11-a1fe-6045bd006295"
source-git-commit: 8ed97e234a68bb7c7aa1e18d12bfed0a5e5a2b9f
workflow-type: tm+mt
source-wordcount: '945'
ht-degree: 38%

---

# Dispatcher バニティー URL


このドキュメントでは、AEMがバニティー URL をどのように処理するか、および書き換えルールを使用してコンテンツを配信の端に近づけるなどの追加の手法を理解するのに役立ちます。

## 説明 {#description}


### 環境

Adobe Experience Manager

### 問題/症状

AEMはバニティー URL をどのように処理しますか？ コンテンツを配信の端に近づけるための方法は他にもありますか？

#### バニティー URL とは

意味のあるフォルダー構造に存在するコンテンツがある場合、必ずしも参照しやすい URL に存在するとは限りません。バニティ URL はショートカットのようなもので、実際のコンテンツが存在する場所を参照する短い、または一意の URL です。

例： <b>*/aboutus</b> ～を指さす <b>/content/we-retail/us/en/about-us.html</b>*

AEM オーサーには、AEM 内のコンテンツの 1 つにバニティ URL プロパティを設定して公開するオプションが用意されています。

この機能を使用するには、バニティを許可するように Dispatcher のフィルターを調整する必要があります。 これは、作成者がこれらのバニティーページエントリを設定する必要がある割合で Dispatcher 設定ファイルを調整する場合に不合理になります。

このため、Dispatcher モジュールには、コンテンツツリーにバニティとしてリストされるすべての項目を自動許可する機能があります。


## 解決策 {#resolution}


### 仕組み

#### バニティ URL の作成

作成者がAEMのページを訪問し、ページのプロパティを訪問して、「バニティ URL」セクションにのエントリを追加します。

変更を保存してページをアクティベートすると、バニティがこのページに割り当てられます。

<b><u>タッチ操作対応 UI</u>:</b>

![](assets/c1e59dbd-38b4-ed11-83fe-6045bd006149.png)

![](assets/c3e59dbd-38b4-ed11-83fe-6045bd006149.png)

<b><u>クラシックコンテンツファインダー</u>:</b>

![](assets/c2e59dbd-38b4-ed11-83fe-6045bd006149.png)

![](assets/c4e59dbd-38b4-ed11-83fe-6045bd006149.png)

<b>注意：</b> これは名前空間の問題に対して非常に脆弱であることを理解してください。 バニティエントリはすべてのページに対してグローバルです。これは、回避策を計画する必要がある短いエントリの 1 つに過ぎません。 私たちは後でそれらのいくつかを説明します。

<b><u>リソースの解決/マッピング</u>:</b>

各バニティエントリは、内部リダイレクトの Sling マップエントリです。 これらのマップは、AEMインスタンスの Felix コンソール (`/system/console/jcrresolver`)

バニティエントリによって作成されたマップエントリのスクリーンショットを次に示します。

![](assets/c5e59dbd-38b4-ed11-83fe-6045bd006149.png)

上記の例では、AEM インスタンスに `/aboutus` へのアクセスを指示すると、`/content/we-retail/us/en/about-us.html` に解決されます。

<b><u>Dispatcher の自動許可フィルター</u>:</b>

安全な状態の Dispatcher は、JCR ツリーのルートなので、Dispatcher のパス/で要求を除外します。

パブリッシャーがコンテンツを許可しているのが、 `/content` その他の安全な道等… `/system` など

ここでは、rub、バニティ URL は/の基本フォルダーにあります。そのため、安全な状態でパブリッシャーに到達するには、どうすればよいですか？

シンプルな Dispatcher には自動フィルターの許可メカニズムがあり、AEMパッケージをインストールしてから、そのパッケージページを指すように Dispatcher を設定する必要があります。 訪問 [ここ](https://experience.adobe.com/#/downloads/content/software-distribution/en/aem.html?package=/content/software-distribution/en/details.html/content/dam/aem/public/adobe/packages/granite/vanityurls-components) AEMパッケージ用。

Dispatcher には、そのファームファイルに設定セクションがあります。


```
/vanity_urls {      /url    "/libs/granite/dispatcher/content/vanityUrls.html"
  /file   "/tmp/vanity_urls"      /delay  300 }
```


この設定は、300 秒ごとにフロントするAEMインスタンスからこの URL を取得し、許可する項目のリストを取得するよう Dispatcher に指示します。

応答のキャッシュを/file 引数に格納します。この例では、/tmp/vanity_urls に格納します。

そのため、URI でAEMインスタンスにアクセスすると、そのインスタンスが取得する内容が表示されます。

![](assets/c6e59dbd-38b4-ed11-83fe-6045bd006149.png)

非常に単純なリストです

#### バニティルールとしてのルールの書き換え

上述のように、AEM に組み込まれているデフォルトのメカニズムの代わりに、書き換えルールを使用することが挙げられるのはなぜでしょうか。

名前空間の問題、パフォーマンス、より適切に処理できる高レベルのロジックについて簡単に説明されています。

バニティエントリの例を見てみましょう `/aboutus` その内容に応じて `/content/we-retail/us/en/about-us.html` Apache の使用 `mod_rewrite` モジュールを使用して、これを実行します。

`RewriteRule /aboutus /content/we-retail/us/en/about-us.html PT,L,NC`

このルールはバニティ `/aboutus` を探し、PT（Pass Through）フラグを使用してレンダラーからフルパスを取得します。

また、他のすべてのルール L フラグ (Last) の処理が停止します。つまり、JCR Resolving などの大量のルールリストをトラバースする必要がなくなります。

リクエストをプロキシする必要なく、AEM 発行者がこのメソッドのこれらの 2 つの要素に応答するのを待つことで、パフォーマンスが大幅に向上します。

さらに良いのは、NC フラグ（大文字と小文字を区別しない）です。つまり、顧客が `/aboutus` の代わりに `/Aboutus` でURL を入力しても、引き続き適切なページを取得できます。

これを実行するために書き換えルールを作成するには、Dispatcher に設定ファイル（例： `/etc/httpd/conf.d/rewrites/examplevanity_rewrite.rules`）を作成し、これらのバニティ URL を適用する必要があるドメインを処理する `.vhost` ファイルに含めます。

次に、内のインクルードのコードスニペットの例を示します。


```
/etc/httpd/conf.d/enabled_vhosts/we-retail.vhost
 VirtualHost *:80    ServerName    weretail.com    ServerAlias 

www.weretail.com        ........ SNIP ........     IfModule mod_rewrite.c   

   ReWriteEngine    on       LogLevel warn rewrite:info

Include /etc/httpd/conf.d/rewrites/examplevanity_rewrite.rules      / IfModule         
   ........ SNIP ......../VirtualHost
```


### どの方法で、どこで使用すればよいですか？

A. AEMを使用してバニティエントリを制御する利点は、次のとおりです。

- 作成者はその場で作成できる
- コンテンツと共に存在し、コンテンツと共にパッケージ化できる


B.使用方法 `mod_rewrite` バニティ・エントリを制御するには、次の利点があります。

- コンテンツの解決を迅速に行う
- エンドユーザーコンテンツリクエストのエッジに近い
- 他の条件でのコンテンツのマッピング方法を制御するための拡張性とオプションの増加
- 大文字と小文字を区別しない場合がある


C.両方の方法を使用しますが、次の場合に使用するアドバイスと条件を示します。

- バニティが一時的なもので、予定されているトラフィックレベルが低い場合は、AEM の組み込み機能を使用します
- バニティーが頻繁に変更されず、頻繁に使用されるステープルエンドポイントの場合は、 `mod_rewrite` ルールを使用します。
- バニティ名前空間（例：`/aboutus`）を同じ AEM インスタンス上の多数のブランドで再利用する必要がある場合は、書き換えルールを使用します。


<b>注意：</b> AEMバニティ機能を使用し、名前空間を避けたい場合は、命名規則を作成できます。 次のようにネストされたバニティー URL の使用 `/brand1/aboutus, brand2/aboutus, brand3/aboutus`
