---
title: "AEM Dispatcher はどの要求をキャッシュしますか？"
description: 説明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS, AEM Dispatcher, cache, AEM, HTTP リクエスト"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "3/27/2023 2:54:13 AM"
article-published-by: Nayanika Chakravarty
article-published-date: "3/27/2023 4:28:42 AM"
version-number: 6
article-number: KA-17497
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9a35dfa5-4acc-ed11-b597-6045bd006b4b"
source-git-commit: ec5b86220d7152eab70588a8ff559e638bf58047
workflow-type: tm+mt
source-wordcount: '0'
ht-degree: 0%

---

# AEM Dispatcher はどの要求をキャッシュしますか？

## 説明 {#description}


<b>環境</b>

AEM Dispatcher 4.3.3

<b>問題</b>

この記事では、AEM Dispatcher が HTTP 要求/応答をキャッシュしない理由を決定します。


## 解決策 {#resolution}


ドキュメントでは、AEM Dispatcher モジュールを介した要求と応答のキャッシュ機能に影響を与える最も重要なシナリオについて説明します。 すべてのキャッシュルールは適用されません。

<b>HTTP リクエストとキャッシュルール</b>

HTTP リクエストを Dispatcher がキャッシュできるようにするには、次のルールに従う必要があります。

1. URL が絶対 URL です（では動作しません）。 または…)、にはファイル拡張子が付き、URL 内のファイル名はファイルシステム上のファイルとして機能します。

   関連するログメッセージ：


   ```
   URI not canonical: %s.
   
   Unable to map URI to file: %s.
   
   cache file path too long
   
   temporary file path too long
   
   request URL has no extension
   ```



   例：


   | `/content/test` | `not cached` |
   | --- | --- |
   | `/content/test.html` | `cached` |


2. 最初のファイル拡張子の後にスラッシュは含まれません。

   関連するログメッセージ：


   ```
   request URL has trailing slash
   ```



   例：


   | `/content/test.html/` | `not cached` |
   | --- | --- |
   | `/content/test.html/foo.jpg` | `not cached` |
   | `/content/test.html` | `cached` |


3. HTTPGETまたはHEAD方式を使用します。

   関連するログメッセージ：


   ```
   request method is neither GET nor HEAD
   ```



   例：


   | `HEAD /content/test.html HTTP/1.1` | `cached` |
   | --- | --- |
   | `GET /content/dam/test.jpg HTTP/1.1` | `not cached` |
   | `POST /content/test.html HTTP/1.1` | `not cached` |


4. この要求は、Dispatcher で定義された/CACHE = /RULES によって拒否されました。 任意のファーム設定。


   関連するログメッセージ：


   ```
   URI not  in cache rules: %s request URL not in cache rules
   ```



   例：


   | ファームに/cache = /rules があり、のリクエストを受け取りました <b>/content/test.html</b><br><br><b>/cache</b><br><br><b>{</b><br><br><b>  ...</b><br><br><b>  /rules</b><br><br><b>  {</b><br><br><b>    /0001 {</b><br><br><b>      type &quot;deny&quot;</b><br><br><b>      glob &quot;\*&quot;</b><br><br><b>      }</b><br><br><b>  }</b><br><br><b>}</b> | キャッシュされません |
   | --- | --- |
   | ファームに/cache = /rules があり、のリクエストを受け取りました <b>/content/test.html</b><br><br><b>/cache</b><br><br><b>{</b><br><br><b>  ...</b><br><br><b>  /rules</b><br><br><b>  {</b><br><br><b>    /0001 {</b><br><br><b>      type &quot;allow&quot;</b><br><br><b>      glob &quot;\*&quot;</b><br><br><b>      }</b><br><br><b>  }</b><br><br><b>}</b> | cached |


5. HTTP リクエストに認証ヘッダーが含まれていないか、ヘッダーが含まれていますが、FARM CONFIGURATION で/ALLOWAUTHORIZED が 1 に設定されています。


   関連するログメッセージ：


   ```
   request contains authorization
   ```



   例：


   | <br><br>    ```<br>    HTTP Request:<br>             GET /content/test.html HTTP/1.1<br>             Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>             dispatcher.any farm /cache = /allowAuthorized configuration:<br>             /cache {<br>              /allowAuthorized “0”<br>             }<br>    ```<br><br> | `not cached` |
   | --- | --- |
   | <br><br>    ```<br>    HTTP Request:<br>             GET /content/test.html HTTP/1.1<br>             Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>             dispatcher.any farm /cache = /allowAuthorized configuration:<br>             /cache {<br>              /allowAuthorized “1”<br>             }<br>    ```<br><br> | `cached` |


6. HTTP リクエストの Cookie ヘッダーに login-token または authorization Cookie が含まれているか、FARM CONFIGURATION でこれらの Cookie のどちらか（または両方）と/ALLOWAUTHORIZED が 1 に設定されています。


   関連するログメッセージ：


   ```
   request contains authorization
   ```



   例：


   | <br><br>    ```<br>    HTTP Request:<br>             GET /content/test.html HTTP/1.1<br>             Cookie: login-token=...<br>             dispatcher.any farm /cache = /allowAuthorized configuration:<br>             /cache {<br>              /allowAuthorized “0”<br>             }<br>    ```<br><br> | `not cached` |
   | --- | --- |
   | <br><br>    ```<br>    HTTP Request:<br>             GET /content/test.html HTTP/1.1<br>             Cookie: authorization= YWxhZGRpbjpvcGVuc2VzYW1l<br>             dispatcher.any farm /cache = /allowAuthorized configuration:<br>             /cache {<br>              /allowAuthorized “0”<br>             }<br>    ```<br><br> | `not cached` |
   | <br><br>    ```<br>    HTTP Request:<br>             GET /content/test.html HTTP/1.1<br>             Cookie: login-token=...<br>             dispatcher.any farm /cache = /allowAuthorized configuration:<br>             /cache {<br>              /allowAuthorized “1”<br>             }<br>    ```<br><br> | `cached` |


7. URL に QUERYSTRING パラメーターがあり、FARM の/IGNOREURLPARAMS 設定で無視できるパラメーターです。

   関連するログメッセージ：


   ```
   request contains a query string
   ```



   例：


   | HTTP リクエスト：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    Farm /cache configuration:<br>    <br>    /ignoreUrlParams {<br>     /0001 { /type “allow” /glob “*” }<br>    }<br>    ```<br><br> | cached |
   | --- | --- |
   | HTTP リクエスト：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    Farm /cache configuration:<br>    <br>    /ignoreUrlParams {<br>     /0001 { /type “deny” /glob “*” } <br>      <br>     /0001 { /type “allow” /glob “test” }<br>    }<br>    ```<br><br> | cached |
   | HTTP リクエスト：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1<br>    dispatcher.any farm /cache = /allowAuthorized configuration:<br>    <br>    /ignoreUrlParams {<br>    <br>     /0001 { /type “deny” /glob “*” } <br>      <br>     /0001 { /type “allow” /glob “q” }<br>    }<br>    ```<br><br> | キャッシュされません |




<b>HTTP 応答およびキャッシュルール：</b>



次の条件を満たす場合、AEMから返された HTTP 応答はキャッシュ可能です。

1. Dispatcher は、定義された「RENDERS」の 1 つから 200 OK 応答を送受信できます。

   <b>注意：</b> 指定しない場合 [/timeout](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=ja) が/renders に設定されているか、0 に設定されている場合、インスタンスがダウンしていても、AEMインスタンスへの接続を永久に待機します。
関連するログメッセージ：


   ```
   Unable to send request to remote server. Unable to receive response from remote server. Remote server returned: %s No backend available.
   ```



   例：


   | HTTP リクエスト：<br><br>    200 OK | cached |
   | --- | --- |
   | HTTP リクエスト：<br><br>    404 ページが見つかりません | キャッシュされません |


2. これらの応答ヘッダーはいずれも応答に存在しません。

   - `Dispatcher: no-cache`
   - `Cache-control: no-cache`
   - `Pragma: no-cache`

   関連するログメッセージ：


   ```
   Backend forbids caching: %s, sent: %s" response contains no_cache
   ```



   例：


   | HTTP 応答：<br><br>    200 OK<br><br>    Dispatcher:no-cache | キャッシュされません |
   | --- | --- |
   | HTTP 応答：<br><br>    200 OK<br><br>    キャッシュ制御：no-cache | キャッシュされません |
   | HTTP 応答：<br><br>    200 OK<br><br>    プラグマ：no-cache | キャッシュされません |
   | HTTP 応答：<br><br>    200 OK | cached |


3. コンテンツの長さの値が 0 バイトを超えています。
関連するログメッセージ：


   ```
   response content length is zero
   ```



   例：


   | HTTP 応答：<br><br>    200 OK<br><br>    Content-Length:0 | キャッシュされません |
   | --- | --- |
   | HTTP 応答：<br><br>    200 OK<br><br>    Content-Length:3120 | cached |



