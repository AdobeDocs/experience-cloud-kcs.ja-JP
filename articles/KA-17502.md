---
title: 基本ファイルレイアウト
description: 説明
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 10:01:28 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:54:38 PM
version-number: 1
article-number: KA-17502
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee3f8d6b-ba32-ec11-b6e5-000d3a5ba97a
exl-id: f86ceaf3-71e2-4bec-a96a-9bc0ae9a9bdc
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1225'
ht-degree: 1%

---

# 基本ファイルレイアウト

## 説明

このドキュメントでは、AMS 標準設定ファイルセットと、この設定標準の背後にある考え方を説明します<br><br><br>

## 解像度

<br><br>デフォルトの Enterprise Linux フォルダ構造<br><br><br><br><br><br>
AMS では、基本インストールは、基本オペレーティングシステムとして Enterprise Linux を使用します。  Apache Web サーバーをインストールすると、デフォルトのインストールファイルが設定されます。  yum リポジトリが提供する基本 RPM をインストールしてインストールするデフォルトのファイルを次に示します
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/``├── conf``│   ├── httpd.conf``│   └── magic``├── conf.d``│   ├── autoindex.conf``│   ├── README``│   ├── userdir.conf``│   └── welcome.conf``├── conf.modules.d``│   ├── 00-base.conf``│   ├── 00-dav.conf``│   ├── 00-lua.conf``│   ├── 00-mpm.conf``│   ├── 00-proxy.conf``│   ├── 00-systemd.conf``│   └── 01-cgi.conf``├── logs - ../..``/var/log/httpd``├── modules - ../..``/usr/lib64/httpd/modules``└── run -``/run/httpd` |
| --- |

<br><br><br><br><br> <br><br>
インストールの設計/構造に従って作業を行うと、次の利点が得られます。

- 予測可能なレイアウトを容易にサポート
- 過去に Enterprise Linux HTTPD のインストールを行った人にとって、自動的に身近なもの
- 競合や手動の調整を行わずに、オペレーティングシステムで完全にサポートされるパッチ適用サイクルを許可
- SELinux のラベル付けされていないファイルコンテキストの違反を回避


注釈:

Adobe Managed Services サーバーのイメージには、通常、小さなオペレーティングシステムのルートドライブが付いています。  データは別のボリュームに配置し、通常は/mnt にマウントします。

次に、以下のデフォルトディレクトリのデフォルトの代わりに、そのボリュームを使用します。

<b>DocumentRoot</b>

- デフォルト：*/var/www/html*
- AMS:*/mnt/var/www/html*


<b>ログディレクトリ</b>

- デフォルト： */var/log/httpd*
- AMS: */mnt/var/log/httpd*


古いディレクトリと新しいディレクトリは、混乱を避けるために元のマウントポイントに再びマッピングされることに注意してください。

別のボリュームを使用することは重要ではありませんが、注意が必要です


<br><br><br><br> <br><br>AMS アドオン<br><br><br><br> <br><br>
AMS は、Apache Web サーバーのベースインストールに追加されます。
<br><br><br><br> <br><br>ドキュメントルート<br><br><br><br> <br><br>
AMS デフォルトのドキュメントルート：

- <b>作成者:</b>
   - */mnt/var/www/author*/
- <b>公開:</b>
   - */mnt/var/www/html/*
- <b>包括的およびヘルスチェックのメンテナンス</b>
   - */mnt/var/www/default/*

 <br><br>VirtualHost ディレクトリのステージングと有効化<br><br><br><br> <br><br>次のディレクトリを使用すると、ファイルで作業できるステージング領域を持つ設定ファイルを構築し、準備が整ったときにのみ有効にすることができます。
- /etc/httpd/conf.d/available_vhosts/
   - このフォルダーは、.vhost と呼ばれるすべての VirtualHost/ファイルをホストします
- /etc/httpd/conf.d/enabled_vhosts/
   - available_vhosts フォルダ内にある.vhost ファイルを使用する準備が整ったら、enabled_vhosts ディレクトリへの相対パスを使用して、それらのファイルを symlink します。

<br><br><br><br> <br><br>追加の conf.d ディレクトリ<br><br><br><br> <br><br>
Apache の設定には共通の部分が追加されており、サブディレクトリを作成して、それらのファイルを分離し、すべてのファイルを 1 つのディレクトリに含めないようにしました

<b>ディレクトリを書き換え</b>

このディレクトリには、作成した\*_rewrite.rules ファイルの中で、通常の *RewriteRule* Apache Web サーバーを関与させる構文 [mod_rewrite](https://httpd.apache.org/docs/current/mod/mod_rewrite.html) モジュール

- */etc/httpd/conf.d/rewrites/*


<b>ホワイトリストディレクトリ</b>

このディレクトリには、作成した\*_whitelist.rules ファイルのうち、通常の *IP 許可* または *IP が必要* Apache Web サーバーを関与させる構文 [アクセス制御](https://httpd.apache.org/docs/2.4/howto/access.html)

- */etc/httpd/conf.d/whitelists/*


<b>変数ディレクトリ</b>

このディレクトリには、作成したすべての\*.vars ファイルを含めることができます。このファイルには、設定ファイルで使用できる変数を含めます

- */etc/httpd/conf.d/variables/*

<br><br><br><br> <br><br>Dispatcher モジュール固有の設定ディレクトリ<br><br><br><br> <br><br>
Apache Web サーバーは非常に拡張可能で、モジュールに多数の設定ファイルがある場合は、デフォルトの設定ディレクトリをクラスター化する代わりに、インストールベースディレクトリの下に独自の設定ディレクトリを作成することをお勧めします。

ベストプラクティスに従って独自のを作成しました

<b>モジュール設定ファイルディレクトリ</b>

- */etc/httpd/conf.dispatcher.d/*

 <br><br>ステージングおよび有効なファームディレクトリ<br><br><br><br> <br><br>次のディレクトリを使用すると、ファイルで作業できるステージング領域を持つ設定ファイルを構築し、準備が整ったときにのみ有効にすることができます。
- /etc/httpd/conf.dispatcher.d/available_farms/
   - このフォルダーは、 */myfarm {* ファイル名 *\*_farm.any*
- /etc/httpd/conf.dispatcher.d/enabled_farms/
   - ファームファイルを使用する準備が整ったら、 available_farms フォルダー内にある symlink を、 enabled_farms ディレクトリへの相対パスを使用してリンクします。

<br><br><br><br> <br><br>追加の conf.dispatcher.d ディレクトリ<br><br><br><br> <br><br>
Dispatcher ファームファイル設定のサブセクションである追加の要素があります。サブディレクトリを作成して、それらのファイルを分離し、1 つのディレクトリにすべてのファイルを含めないようにしました

<b>キャッシュディレクトリ</b>

このディレクトリには、作成するすべての\*_cache.any、\*_invalidate.any ファイルが含まれています。このファイルには、AEMから取得されたキャッシュ要素をモジュールで処理する方法と無効化ルール構文に関する規則が含まれています。  この節の詳細は、 [ここ](https://docs.adobe.com/content/help/en/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)

- */etc/httpd/conf.dispatcher.d/cache/*


<b>クライアントヘッダーディレクトリ</b>

このディレクトリには、作成したすべての\*_clientheaders.any ファイルを含めることができます。このファイルには、要求が受信されたときにAEMに渡すクライアントヘッダーのリストが含まれます。  この節の詳細は、 [ここ](https://docs.adobe.com/content/help/ja-JP/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#specifying-the-http-headers-to-pass-through-clientheaders)

- */etc/httpd/conf.dispatcher.d/clientheaders/*


<b>Filters ディレクトリ</b>

このディレクトリには、作成するすべての\*_filters.any ファイルを含めることができます。このファイルには、Dispatcher を介したトラフィックがAEMに到達するのをブロックまたは許可するすべてのフィルタールールが含まれます

- */etc/httpd/conf.dispatcher.d/filters/*


<b>レンダリングディレクトリ</b>

このディレクトリには、Dispatcher がコンテンツを使用する各バックエンドサーバーへの接続の詳細を含む、作成したすべての\*_renders.any ファイルを含めることができます。

- */etc/httpd/conf.dispatcher.d/renders/*


<b>Vhosts ディレクトリ</b>

このディレクトリには、作成したすべての\*_vhosts.any ファイルを含めることができます。このファイルには、特定のバックエンドサーバーに対する特定のファームに一致するドメイン名とパスのリストが含まれます

- */etc/httpd/conf.dispatcher.d/vhosts/*

<br><br><br><br> <br><br>フォルダー構造全体<br><br><br><br> <br><br>
AMS では、名前空間の問題や競合、混乱を避けるために、カスタムファイル拡張子を持つ各ファイルを構造化しています。

AMS のデフォルトデプロイメントの標準ファイルセットの例を次に示します。
<br><br><br><br><br> <br><br><br><br>

| `/etc/httpd/``├── conf``│   ├── httpd.conf``│   └── magic``├── conf.d``│   ├── autoindex.conf``│   ├── available_vhosts``│   │   ├── 000_unhealthy_author.vhost``│   │   ├── 000_unhealthy_publish.vhost``│   │   ├── aem_author.vhost``│   │   ├── aem_flush.vhost``│   │   ├── aem_health.vhost``│   │   ├── aem_lc.vhost``│   │   └── aem_publish.vhost``│   ├── dispatcher_vhost.conf``│   ├── enabled_vhosts``│   │   ├── aem_author.vhost - ..``/available_vhosts/aem_author``.vhost``│   │   ├── aem_flush.vhost - ..``/available_vhosts/aem_flush``.vhost``│   │   ├── aem_health.vhost - ..``/available_vhosts/aem_health``.vhost``│   │   └── aem_publish.vhost - ..``/available_vhosts/aem_publish``.vhost``│   ├── README``│   ├── rewrites``│   │   ├── base_rewrite.rules``│   │   └── xforwarded_forcessl_rewrite.rules``│   ├── userdir.conf``│   ├── variables``│   │   └── ams_default.vars``│   ├── welcome.conf``│   └── whitelists``│       └── 000_base_whitelist.rules``├── conf.dispatcher.d``│   ├── available_farms``│   │   ├── 000_ams_author_farm.any``│   │   ├── 001_ams_lc_farm.any``│   │   └── 999_ams_publish_farm.any``│   ├── cache``│   │   ├── ams_author_cache.any``│   │   ├── ams_author_invalidate_allowed.any``│   │   ├── ams_publish_cache.any``│   │   └── ams_publish_invalidate_allowed.any``│   ├── clientheaders``│   │   ├── ams_author_clientheaders.any``│   │   ├── ams_common_clientheaders.any``│   │   ├── ams_lc_clientheaders.any``│   │   └── ams_publish_clientheaders.any``│   ├── dispatcher.any``│   ├── enabled_farms``│   │   ├── 000_ams_author_farm.any - ..``/available_farms/000_ams_author_farm``.any``│   │   └── 999_ams_publish_farm.any - ..``/available_farms/999_ams_publish_farm``.any``│   ├── filters``│   │   ├── ams_author_filters.any``│   │   ├── ams_lc_filters.any``│   │   └── ams_publish_filters.any``│   ├── renders``│   │   ├── ams_author_renders.any``│   │   ├── ams_lc_renders.any``│   │   └── ams_publish_renders.any``│   └── vhosts``│       ├── ams_author_vhosts.any``│       ├── ams_lc_vhosts.any``│       └── ams_publish_vhosts.any``├── conf.modules.d``│   ├── 00-base.conf``│   ├── 00-dav.conf``│   ├── 00-lua.conf``│   ├── 00-mpm.conf``│   ├── 00-proxy.conf``│   ├── 00-systemd.conf``│   ├── 01-cgi.conf``│   └── 02-dispatcher.conf``├── logs - ../..``/var/log/httpd``├── modules - ../..``/usr/lib64/httpd/modules``└── run -``/run/httpd` |
| --- |

<br><br><br><br><br> <br><br>理想的な状態を維持<br><br><br><br> <br><br>
Enterprise Linux には、Apache Webserver Package(httpd) のパッチ適用サイクルがあります。

RPM / Yum コマンドを使用して、パッチが適用されたセキュリティ修正や構成の改善が適用された場合、変更されたファイルの上に修正が適用されないため、インストールされたデフォルトファイルの数が少ないほど、変更が適用されます。

代わりに、元のファイルの横に.rpmnew ファイルが作成されます。  これは、必要な変更が一部失われ、設定フォルダーにガベージが作成される可能性があることを意味します。

Enterprise Linux は、この使用例をより適切に処理するために適切にセットアップされていました。  設定した既定値を拡張または上書きできる領域が提供されます。  httpd のベースインストールの中には/etc/httpd/conf/httpd.confファイルがあり、その中に次のような構文があります。


<br><br><br><br><br> <br><br><br><br>

| `Include conf.modules.d/*.conf``IncludeOptional conf.d/*.conf` |
| --- |

<br><br><br><br><br> <br><br>
Apache では、新しいファイルを<b> /etc/httpd/conf.d/ </b>および <b>/etc/httpd/conf.modules.d/</b> のファイル拡張子を持つディレクトリ <b>.conf</b>

Dispatcher モジュールを Apache に追加する際の最適な例として、にモジュールの.so ファイルを作成します。 <b>/etc/httpd/modules/</b> 次に、 <b>/etc/httpd/conf.modules.d/02-dispatcher.conf</b> モジュールの.so ファイルを読み込む内容を含んだ
<br><br><br><br><br> <br><br><br><br>

| `LoadModule dispatcher_module modules/mod_dispatcher.so` |
| --- |

<br><br><br><br><br> <br><br>
<b>通知</b> Apache が提供した既存のファイルは変更されませんでした。  代わりに、彼らが行くべきディレクトリに私たちを追加した。

現在は、ファイル内のモジュールを使用しています。 <b>/etc/httpd/conf.d/dispatcher_vhost.conf</b> モジュールを初期化し、初期モジュール固有の設定ファイルを読み込む
<br><br><br><br><br> <br><br><br><br>

| `IfModule disp_apache2.c``    ``DispatcherConfig conf.dispatcher.d/dispatcher.any``    ``...SNIP...``/IfModule` |
| --- |

<br><br><br><br><br> <br><br>
ファイルとモジュールが追加されましたが、元のファイルは変更されていません。  これにより、必要な機能が提供され、必要なパッチ修正が見つからなくなるのを防ぎ、パッケージのアップグレードごとに最高レベルの互換性を維持できます。
