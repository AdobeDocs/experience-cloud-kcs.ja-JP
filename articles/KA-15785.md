---
title: Campaign ClassicV7 — データベース更新ウィザードで生成された SQL クエリの最適化
description: 説明
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Marta Zator
article-created-date: 5/5/2022 10:16:35 AM
article-published-by: Marta Zator
article-published-date: 5/5/2022 10:18:58 AM
version-number: 2
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e810bb6a-5ccc-ec11-a7b5-6045bd00dbbc
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '318'
ht-degree: 1%

---

# Campaign ClassicV7 — データベース更新ウィザードで生成された SQL クエリの最適化

## 説明


<b>背景とコンテキスト：</b>
ほとんどの [!DNL Campaign] 次を含むビルド [!DNL Gold Standard] 9032 個のコンポーネントがある場合、既存のスキーマに新しい列を追加する際に複数の問題が発生する可能性があります。

この記事の範囲は、次に関連する 1 つの特定の問題に対処することです。

- レコードが既に存在する場合に、既存のスキーマに整数フィールドを追加する。
- アプリケーションで生成された SQL クエリを Postgres SQL 用の Efficient クエリに最適化します。


<b>使用例：</b> 
<br>既存の受信者テーブルまたは既に 100 万件を超えるレコードを持つその他のテーブルがあります。
<br>次に、整数型のデータ型のテーブルに列を 1 つ追加する必要があります。
<br>スキーマ定義にその列を追加し、データベースの変更をコミットします。

<b>課題 </b>:
<br>データベースの更新中に問題が発生し、データベースでデッドロックが発生したか、クエリが他の操作をブロックしました。
<br>これは主に、データベースウィザードで生成された SQL コマンドに基づいて、すべてのレコードが 0 に更新されるためです。


<br> <br>

## 解像度


ソリューション :

整数列を追加する場合、次のように生成された SQL 文が取得されます。

```
ALTER TABLE NmsRecipient ADD column_name SMALLINT;
UPDATE NmsRecipient SET column_name = 0;
ALTER TABLE NmsRecipient ALTER COLUMN column_name SET Default 0;
ALTER TABLE NmsRecipient ALTER COLUMN icolumn_name SET NOT NULL;
```

この問題は、データベース内で 4 つのコマンドが並行して実行され、パフォーマンスの問題やデッドロックが発生する可能性がある点です。

解決策は、これらの 4 つのコマンドを 1 つにまとめて、以下と同じ変更を行うことです。

```
ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0 ;
```

必要なすべての変更を行い、列を追加し、デフォルトを設定し、を設定します。 `NOT NULL`また、 `NOT NULL` 制約。



<b>メモ：</b>

複数の整数列を追加する必要がある場合は、列を 1 つずつ追加し、変更ごとにデータベースウィザードを実行します。

これは、ステートメントがすべて更新されるので、操作をスムーズにするためです <b>既存 </b>レコードを 0 に設定し、数に応じて追加します。 時間がかかる可能性があるレコードの数。
